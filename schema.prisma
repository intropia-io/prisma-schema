generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["filteredRelationCount"]
}

datasource db {
  provider = "postgresql"
  url      = env("NEXT_PUBLIC_DATABASE_URL")
}

model Admin {
  id            String          @id @default(cuid())
  name          String
  email         String          @unique
  password      String
  image         String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  color         String          @default("#060a1b")
  role          AdminRole       @default(USER)
  events        Events[]
  Logs          Logs[]
  organizations Organizations[]
  quests        Quests[]
}

model Dynasty {
  id                String           @id @default(cuid())
  name              String
  avatar            String?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  description       String?
  published         Boolean          @default(false)
  quests            Quests[]
  User              User?            @relation(fields: [userId], references: [id])
  userId            String?
  botSubscription   BotSubscription? @relation(fields: [botSubscriptionId], references: [id])
  botSubscriptionId String?
}

model Token {
  id           String   @id @default(cuid())
  name         String
  avatar       String
  published    Boolean  @default(false)
  events       Events[]
  TokenDefault Quests[] @relation("TokenDefault")
  TokenReward  Quests[] @relation("TokenReward")
}

model Organizations {
  id              String       @id @default(cuid())
  name            String
  description     String?
  typeId          String?
  avatar          String
  cover           String?
  color           String
  market          String?
  treasury        String?
  linkWebsite     String?
  linkTelegram    String?
  linkTwitter     String?
  linkReddit      String?
  linkDiscord     String?
  linkMedium      String?
  dateFounded     String?
  verified        Boolean      @default(false)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  userId          String?      @default(" ")
  textBlocks      String?
  contractAddress String?
  state           EntityStates @default(DRAFT)
  type            Type?        @relation(fields: [typeId], references: [id], onDelete: SetNull)
  user            Admin?       @relation(fields: [userId], references: [id], onDelete: SetNull)
  events          Events[]
  quests          Quests[]
  tags            Tags[]
}

model Quests {
  id                     String                   @id @default(cuid())
  title                  String
  description            String?
  typeId                 String?
  salaryRange            String?
  reffReward             Float?
  linkApply              String
  organizationId         String
  tokenId                String?
  dynastyId              String?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @updatedAt
  userId                 String?                  @default(" ")
  textBlocks             String?
  rewardFrom             Float?
  rewardTo               Float?
  reffLink               String?
  tokenRewardId          String?
  state                  EntityStates             @default(DRAFT)
  dynasty                Dynasty?                 @relation(fields: [dynastyId], references: [id], onDelete: SetNull)
  organization           Organizations            @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  token                  Token?                   @relation("TokenDefault", fields: [tokenId], references: [id], onDelete: Cascade)
  tokenReward            Token?                   @relation("TokenReward", fields: [tokenRewardId], references: [id], onDelete: Cascade)
  type                   Type?                    @relation(fields: [typeId], references: [id], onDelete: Cascade)
  user                   Admin?                   @relation(fields: [userId], references: [id], onDelete: SetNull)
  tags                   Tags[]
  QuestLinksStatusErrors QuestLinksStatusErrors[]
}

model QuestLinksStatusErrors {
  id            String       @id @default(cuid())
  questId       String
  link          String
  status        String
  createdAt     DateTime     @default(now())
  quest         Quests       @relation(fields: [questId], references: [id], onDelete: Cascade)
  scheduleLog   ScheduleLog? @relation(fields: [scheduleLogId], references: [id], onDelete: Cascade)
  scheduleLogId String?
}

model ScheduleLog {
  id        String                   @id @default(cuid())
  name      String
  logs      QuestLinksStatusErrors[]
  createdAt DateTime                 @default(now())
}

model Events {
  id             String        @id @default(cuid())
  title          String
  description    String?
  avatar         String
  typeId         String?
  cost           String?
  priceFrom      Float?
  startDate      DateTime
  endDate        DateTime?
  geo            String?
  linkApply      String
  linkWebsite    String?
  linkTelegram   String?
  linkTwitter    String?
  linkReddit     String?
  linkDiscord    String?
  linkMedium     String?
  organizationId String
  isSoldOut      Boolean       @default(false)
  isOnline       Boolean       @default(false)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  userId         String?       @default(" ")
  textBlocks     String
  priceTo        Float?
  tokenId        String?
  state          EntityStates  @default(DRAFT)
  organization   Organizations @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  token          Token?        @relation(fields: [tokenId], references: [id], onDelete: Cascade)
  type           Type?         @relation(fields: [typeId], references: [id], onDelete: SetNull)
  user           Admin?        @relation(fields: [userId], references: [id], onDelete: SetNull)
  tags           Tags[]
}

model Tags {
  id            String          @id @default(cuid())
  name          String
  description   String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  published     Boolean         @default(false)
  events        Events[]
  organizations Organizations[]
  quests        Quests[]
}

model Type {
  id                     String           @id @default(cuid())
  name                   String
  description            String?
  color                  String?
  discordChannelId       String?
  createdAt              DateTime         @default(now())
  updatedAt              DateTime         @updatedAt
  published              Boolean          @default(false)
  categoryType           CategoryType     @default(INSTITUTE)
  customRules            CustomRules[]
  events                 Events[]
  organization           Organizations[]
  quest                  Quests[]
  botSubscriptionQuest   BotSubscription? @relation("questTypes", fields: [botSubscriptionQuestId], references: [id])
  botSubscriptionQuestId String?
  botSubscriptionEvent   BotSubscription? @relation("eventTypes", fields: [botSubscriptionEventId], references: [id])
  botSubscriptionEventId String?
}

model Logs {
  id          String          @id @default(cuid())
  description String?
  title       String          @default("")
  itemId      String
  userId      String
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  type        LogEntity       @default(UNDEFINED)
  action      LogEntityAction @default(UNDEFINED)
  user        Admin           @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Suggest {
  id        String   @id @default(cuid())
  type      String
  content   Json
  page      String?
  ip        String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Image {
  id        String   @id @default(cuid())
  url       String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Report {
  id           String     @id @default(cuid())
  type         String
  description  String
  reportTypeId String
  ReportType   ReportType @relation(fields: [reportTypeId], references: [id])
}

model ReportType {
  id     String   @id @default(cuid())
  name   String
  Report Report[]
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model User {
  id              String            @id @default(cuid())
  name            String?
  email           String?           @unique
  emailVerified   DateTime?
  image           String?
  firstName       String?
  lastName        String?
  description     String?
  resumeLink      String?
  contactEmail    String?
  twitterLink     String?
  githubLink      String?
  telegram        String?
  dynasty         Dynasty[]
  nonce           String?
  publicAddress   String?           @unique
  accounts        Account[]
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @default(now()) @updatedAt
  UserAggrigation UserAggrigation[]
}

model UserAggrigation {
  id            String   @id @default(cuid())
  name          String?
  user          User     @relation(fields: [id], references: [id], onDelete: Cascade)
  email         String?  @unique
  image         String?
  firstName     String?
  lastName      String?
  description   String?
  resumeLink    String?
  contactEmail  String?
  twitterLink   String?
  githubLink    String?
  telegram      String?
  publicAddress String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now()) @updatedAt
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model BotSubscription {
  id              String          @id @default(cuid())
  userId          String
  fisrtName       String?
  lastName        String?
  username        String?
  dynasties       Dynasty[]
  questTypes      Type[]          @relation("questTypes")
  eventTypes      Type[]          @relation("eventTypes")
  reffProgram     ReffProgram
  updateFrequency UpdateFrequency
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
}

model RestUser {
  id String @id @default(cuid())
  name String
  token String
}

enum CategoryType {
  INSTITUTE
  EVENT
  QUEST
}

enum CustomRules {
  NO_REWARD
  HIDE_FROM_EXPLORER
}

enum EntityStates {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum LogEntity {
  UNDEFINED
  INSTITUTE
  QUEST
  EVENT
  DYNASTY
  TOKEN
  TAG
  TYPE
  CATEGORY
  SUGGEST
  IMAGE
  REPORT
  REPORT_TYPE
  ERROR
}

enum LogEntityAction {
  UNDEFINED
  CREATE
  UPDATE
  ARCHIVE
  PUBLISH
  DELETE
}

enum AdminRole {
  ADMIN
  MANAGER
  USER
}

enum ReffProgram {
  SUBSCRIBED
  UNSUBSCRIBED
}

enum UpdateFrequency {
  WEEKLY
  REALTIME
}
